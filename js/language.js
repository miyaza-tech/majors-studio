// ===== LANGUAGE SWITCHER =====

// ÌòÑÏû¨ Ïñ∏Ïñ¥ ÏÉÅÌÉú
let currentLang = localStorage.getItem('language') || 'en';
let translations = {};

// Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
async function loadTranslations() {
    try {
        const response = await fetch('data/translations.json');
        translations = await response.json();
        console.log('‚úÖ Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å');
        return translations;
    } catch (error) {
        console.error('‚ùå Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
        return null;
    }
}

// ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÏñëÎ∞©Ìñ•)
async function loadProjectData() {
    try {
        const response = await fetch('data/projects_json.json');
        const data = await response.json();
        console.log('‚úÖ ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å');
        return data;
    } catch (error) {
        console.error('‚ùå ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
        return null;
    }
}

// Ïñ∏Ïñ¥ Ï†ÑÌôò Ìï®Ïàò
function switchLanguage(lang) {
    if (!translations || Object.keys(translations).length === 0) {
        console.warn('‚ö†Ô∏è Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
        return;
    }

    currentLang = lang;
    localStorage.setItem('language', lang);
    
    // Ïñ∏Ïñ¥ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    updateLanguageButtons();
    
    // ÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏† ÏóÖÎç∞Ïù¥Ìä∏
    updatePageContent();
    updateProjectsPage();
    updateBlogPage();
    
    // HTML lang ÏÜçÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
    document.documentElement.lang = lang === 'ko' ? 'ko' : 'en';
    
    // Dispatch custom event for other scripts to listen
    window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
    
    console.log(`üåê Ïñ∏Ïñ¥ Ï†ÑÌôò: ${lang.toUpperCase()}`);
}

// Ïñ∏Ïñ¥ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
function updateLanguageButtons() {
    // Î™®Î∞îÏùº Î≤ÑÏ†Ñ (ÌñÑÎ≤ÑÍ±∞ Î©îÎâ¥ Ïïà)
    const enBtn = document.getElementById('langEN');
    const koBtn = document.getElementById('langKO');
    
    // Îç∞Ïä§ÌÅ¨ÌÜ± Î≤ÑÏ†Ñ (Ïò§Î•∏Ï™Ω)
    const enBtnDesktop = document.getElementById('langEN-desktop');
    const koBtnDesktop = document.getElementById('langKO-desktop');
    
    if (currentLang === 'en') {
        if (enBtn) enBtn.classList.add('active');
        if (koBtn) koBtn.classList.remove('active');
        if (enBtnDesktop) enBtnDesktop.classList.add('active');
        if (koBtnDesktop) koBtnDesktop.classList.remove('active');
    } else {
        if (enBtn) enBtn.classList.remove('active');
        if (koBtn) koBtn.classList.add('active');
        if (enBtnDesktop) enBtnDesktop.classList.remove('active');
        if (koBtnDesktop) koBtnDesktop.classList.add('active');
    }
}

// ÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏† ÏóÖÎç∞Ïù¥Ìä∏
function updatePageContent() {
    // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
    updateNavigation();
    
    // About ÏÑπÏÖò
    updateAbout();
    
    // Latest Projects ÏÑπÏÖò
    updateLatestProjects();
    
    // Gallery ÏÑπÏÖò
    updateGallery();
    
    // Services ÏÑπÏÖò
    updateServices();
    
    // Clients ÏÑπÏÖò
    updateClients();
    
    // Testimonials ÏÑπÏÖò
    updateTestimonials();
    
    // Contact ÏÑπÏÖò
    updateContact();
    
    // Footer
    updateFooter();
    
    // Meta ÌÉúÍ∑∏
    updateMetaTags();
}

// ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateNavigation() {
    // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î©îÎâ¥Îäî Ìï≠ÏÉÅ ÏòÅÎ¨∏ÏúºÎ°ú Ïú†ÏßÄ (Ï†úÎ™©Ïù¥ÎØÄÎ°ú)
    // Î©îÎâ¥Îäî HTMLÏóê ÌïòÎìúÏΩîÎî©ÎêòÏñ¥ ÏûàÍ≥† Ìï≠ÏÉÅ ÏòÅÎ¨∏Ïù¥ÎØÄÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏßÄ ÏïäÏùå
    // Î°úÍ≥†ÎèÑ Î≥ÄÍ≤ΩÌïòÏßÄ ÏïäÏùå (MAJORS STUDIOÎ°ú Í≥†Ï†ï)
}

// About ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateAbout() {
    const about = translations.about;
    if (!about) return;
    
    const titleElement = document.querySelector('.about h2');
    const contentElement = document.querySelector('.about p');
    
    if (titleElement && about.title) {
        titleElement.textContent = about.title[currentLang];
    }
    
    if (contentElement && about.content) {
        contentElement.textContent = about.content[currentLang];
    }
}

// Latest Projects ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateLatestProjects() {
    const projects = translations.latestProjects;
    if (!projects) return;
    
    const titleElement = document.querySelector('.latest-projects h2');
    if (titleElement && projects.title) {
        titleElement.textContent = projects.title[currentLang];
    }
    
    const ctaButton = document.querySelector('.latest-projects-cta .cta-button');
    if (ctaButton && projects.viewAll) {
        ctaButton.textContent = projects.viewAll[currentLang];
    }
    
    // ÌîÑÎ°úÏ†ùÌä∏ ÏïÑÏù¥ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
    const projectItems = document.querySelectorAll('.latest-project-item');
    projectItems.forEach((item, index) => {
        if (projects.items && projects.items[index]) {
            const titleEl = item.querySelector('.latest-project-overlay h4');
            const categoryEl = item.querySelector('.latest-project-overlay p');
            
            if (titleEl && projects.items[index].title) {
                titleEl.textContent = projects.items[index].title[currentLang];
            }
            if (categoryEl && projects.items[index].category) {
                categoryEl.textContent = projects.items[index].category[currentLang];
            }
        }
    });
}

// Gallery ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateGallery() {
    const gallery = translations.gallery;
    if (!gallery) return;
    
    const titleElement = document.querySelector('.gallery h2');
    if (titleElement && gallery.title) {
        titleElement.textContent = gallery.title[currentLang];
    }
    
    const ctaButton = document.querySelector('.gallery-cta .cta-button');
    if (ctaButton && gallery.viewFull) {
        ctaButton.textContent = gallery.viewFull[currentLang];
    }
    
    // Í∞§Îü¨Î¶¨ ÏïÑÏù¥ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
    const galleryItems = document.querySelectorAll('.gallery-item');
    galleryItems.forEach((item, index) => {
        if (gallery.items && gallery.items[index]) {
            const titleEl = item.querySelector('.gallery-overlay h4');
            const categoryEl = item.querySelector('.gallery-overlay p');
            
            if (titleEl && gallery.items[index].title) {
                titleEl.textContent = gallery.items[index].title[currentLang];
            }
            if (categoryEl && gallery.items[index].category) {
                categoryEl.textContent = gallery.items[index].category[currentLang];
            }
        }
    });
}

// Services ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateServices() {
    const services = translations.services;
    if (!services) return;
    
    const titleElement = document.querySelector('.services h2');
    if (titleElement && services.title) {
        titleElement.textContent = services.title[currentLang];
    }
    
    const serviceItems = document.querySelectorAll('.service-item');
    serviceItems.forEach((item, index) => {
        if (services.items && services.items[index]) {
            const titleEl = item.querySelector('h3');
            const descEl = item.querySelector('p');
            
            if (titleEl && services.items[index].title) {
                titleEl.textContent = services.items[index].title[currentLang];
            }
            if (descEl && services.items[index].description) {
                descEl.textContent = services.items[index].description[currentLang];
            }
        }
    });
}

// Clients ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateClients() {
    const clients = translations.clients;
    if (!clients) return;
    
    const titleElement = document.querySelector('.clients h2');
    if (titleElement && clients.title) {
        titleElement.textContent = clients.title[currentLang];
    }
}

// Testimonials ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateTestimonials() {
    const testimonials = translations.testimonials;
    if (!testimonials) return;
    
    const titleElement = document.querySelector('.testimonials h2');
    if (titleElement && testimonials.title) {
        titleElement.textContent = testimonials.title[currentLang];
    }
    
    const testimonialItems = document.querySelectorAll('.testimonial-item');
    testimonialItems.forEach((item, index) => {
        if (testimonials.items && testimonials.items[index]) {
            const textEl = item.querySelector('p');
            const authorEl = item.querySelector('.testimonial-author');
            
            if (textEl && testimonials.items[index].text) {
                textEl.textContent = `"${testimonials.items[index].text[currentLang]}"`;
            }
            if (authorEl && testimonials.items[index].author) {
                authorEl.textContent = testimonials.items[index].author[currentLang];
            }
        }
    });
}

// Contact ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
function updateContact() {
    const contact = translations.contact;
    if (!contact) return;
    
    // ÏôºÏ™Ω Ï†ïÎ≥¥
    const infoTitle = document.querySelector('.contact-left h2');
    if (infoTitle && contact.infoTitle) {
        infoTitle.textContent = contact.infoTitle[currentLang];
    }
    
    const intro = document.querySelector('.contact-intro');
    if (intro && contact.intro) {
        intro.textContent = contact.intro[currentLang];
    }
    
    const contactItems = document.querySelectorAll('.contact-item h4');
    if (contactItems[0] && contact.location) {
        contactItems[0].textContent = contact.location[currentLang];
    }
    if (contactItems[1] && contact.email) {
        contactItems[1].textContent = contact.email[currentLang];
    }
    if (contactItems[2] && contact.social) {
        contactItems[2].textContent = contact.social[currentLang];
    }
    
    const locationText = document.querySelector('.contact-item p');
    if (locationText && contact.locationText) {
        locationText.textContent = contact.locationText[currentLang];
    }
    
    // Ïò§Î•∏Ï™Ω Ìèº
    const formTitle = document.querySelector('.contact-right h2');
    if (formTitle && contact.formTitle) {
        formTitle.textContent = contact.formTitle[currentLang];
    }
    
    const nameInput = document.getElementById('name');
    if (nameInput && contact.namePlaceholder) {
        nameInput.placeholder = contact.namePlaceholder[currentLang];
    }
    
    const emailInput = document.getElementById('email');
    if (emailInput && contact.emailPlaceholder) {
        emailInput.placeholder = contact.emailPlaceholder[currentLang];
    }
    
    const projectTypeSelect = document.getElementById('projectType');
    if (projectTypeSelect && contact.projectTypePlaceholder) {
        projectTypeSelect.options[0].textContent = contact.projectTypePlaceholder[currentLang];
        
        if (contact.projectTypes) {
            projectTypeSelect.options[1].textContent = contact.projectTypes.conceptArt[currentLang];
            projectTypeSelect.options[2].textContent = contact.projectTypes.characterDesign[currentLang];
            projectTypeSelect.options[3].textContent = contact.projectTypes.environmentDesign[currentLang];
            projectTypeSelect.options[4].textContent = contact.projectTypes.illustration[currentLang];
            projectTypeSelect.options[5].textContent = contact.projectTypes.artDirection[currentLang];
            projectTypeSelect.options[6].textContent = contact.projectTypes.multiple[currentLang];
            projectTypeSelect.options[7].textContent = contact.projectTypes.consultation[currentLang];
        }
    }
    
    const messageInput = document.getElementById('message');
    if (messageInput && contact.messagePlaceholder) {
        messageInput.placeholder = contact.messagePlaceholder[currentLang];
    }
    
    const submitButton = document.querySelector('.submit-btn');
    if (submitButton && contact.submitButton) {
        submitButton.textContent = contact.submitButton[currentLang];
    }
}

// Footer ÏóÖÎç∞Ïù¥Ìä∏
function updateFooter() {
    const footer = translations.footer;
    if (!footer) return;
    
    const copyright = document.querySelector('footer p');
    if (copyright && footer.copyright) {
        copyright.textContent = footer.copyright[currentLang];
    }
}

// Meta ÌÉúÍ∑∏ ÏóÖÎç∞Ïù¥Ìä∏
function updateMetaTags() {
    const meta = translations.meta;
    if (!meta) return;
    
    if (meta.title) {
        document.title = meta.title[currentLang];
    }
    
    const metaDescription = document.querySelector('meta[name="description"]');
    if (metaDescription && meta.description) {
        metaDescription.setAttribute('content', meta.description[currentLang]);
    }
    
    const metaKeywords = document.querySelector('meta[name="keywords"]');
    if (metaKeywords && meta.keywords) {
        metaKeywords.setAttribute('content', meta.keywords[currentLang]);
    }
    
    const ogTitle = document.querySelector('meta[property="og:title"]');
    if (ogTitle && meta.title) {
        ogTitle.setAttribute('content', meta.title[currentLang]);
    }
    
    const ogDescription = document.querySelector('meta[property="og:description"]');
    if (ogDescription && meta.ogDescription) {
        ogDescription.setAttribute('content', meta.ogDescription[currentLang]);
    }
    
    const twitterTitle = document.querySelector('meta[name="twitter:title"]');
    if (twitterTitle && meta.title) {
        twitterTitle.setAttribute('content', meta.title[currentLang]);
    }
    
    const twitterDescription = document.querySelector('meta[name="twitter:description"]');
    if (twitterDescription && meta.ogDescription) {
        twitterDescription.setAttribute('content', meta.ogDescription[currentLang]);
    }
}

// Projects ÌéòÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
function updateProjectsPage() {
    // Projects ÌéòÏù¥ÏßÄÏùò ÌïÑÌÑ∞ ÌÉ≠ÏùÄ Ìï≠ÏÉÅ ÏòÅÎ¨∏ÏúºÎ°ú Ïú†ÏßÄ
    // (Ï†úÎ™©Ïù¥ÎØÄÎ°ú ÏòÅÎ¨∏ÏúºÎ°ú ÌÜµÏùº)
    const filterTabs = document.querySelectorAll('.filter-tab');
    if (filterTabs.length > 0 && filterTabs.length === 5) {
        // Projects page filter
        filterTabs[0].textContent = 'All Projects';
        filterTabs[1].textContent = 'Games';
        filterTabs[2].textContent = 'Character Design';
        filterTabs[3].textContent = 'Concept Art';
        filterTabs[4].textContent = 'Promotional';
    }
}

// Blog ÌéòÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
function updateBlogPage() {
    // Blog ÌéòÏù¥ÏßÄÏùò Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉ≠ÏùÄ Ìï≠ÏÉÅ ÏòÅÎ¨∏ÏúºÎ°ú Ïú†ÏßÄ
    const categoryTabs = document.querySelectorAll('.category-tab');
    if (categoryTabs.length > 0) {
        categoryTabs[0].textContent = 'All Posts';
        if (categoryTabs[1]) categoryTabs[1].textContent = 'Tutorials';
        if (categoryTabs[2]) categoryTabs[2].textContent = 'Process';
        if (categoryTabs[3]) categoryTabs[3].textContent = 'Industry';
        if (categoryTabs[4]) categoryTabs[4].textContent = 'Showcase';
    }
    
    // Gallery ÌéòÏù¥ÏßÄÏùò ÌïÑÌÑ∞ ÌÉ≠ÏùÄ Ìï≠ÏÉÅ ÏòÅÎ¨∏ÏúºÎ°ú Ïú†ÏßÄ
    const galleryFilterTabs = document.querySelectorAll('.filter-tab');
    if (galleryFilterTabs.length > 0 && galleryFilterTabs.length === 6) {
        // Gallery page filter
        galleryFilterTabs[0].textContent = 'All Works';
        galleryFilterTabs[1].textContent = 'Illustration';
        galleryFilterTabs[2].textContent = 'Concept Art';
        galleryFilterTabs[3].textContent = 'Character';
        galleryFilterTabs[4].textContent = 'Environment';
        galleryFilterTabs[5].textContent = 'Key Art';
    }
}

// Ï¥àÍ∏∞Ìôî Ìï®Ïàò
async function initLanguage() {
    console.log('üåê Ïñ∏Ïñ¥ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî Ï§ë...');
    
    // Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    await loadTranslations();
    
    // Ï†ÄÏû•Îêú Ïñ∏Ïñ¥ ÏÑ§Ï†ï Î≥µÏõê
    currentLang = localStorage.getItem('language') || 'en';
    
    // Ïñ∏Ïñ¥ Î≤ÑÌäº ÌôúÏÑ±Ìôî
    updateLanguageButtons();
    
    // ÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏† ÏóÖÎç∞Ïù¥Ìä∏
    if (currentLang === 'ko') {
        updatePageContent();
        updateProjectsPage();
        updateBlogPage();
    }
    
    console.log(`‚úÖ Ïñ∏Ïñ¥ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å (ÌòÑÏû¨: ${currentLang.toUpperCase()})`);
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
document.addEventListener('DOMContentLoaded', initLanguage);
